services:
  verification:
    build: ./services/verification-svc
    image: verification-svc:1.0.0
    ports: ["3001:3001"]

  issuance:
    build: ./services/issuance-svc
    image: issuance-svc:1.0.0
    environment:
      - REPLICATE_URL=http://verification:3001
    ports: ["3000:3000"]
    depends_on: [verification]

  # DEV frontend (Vite) – run with: docker compose --profile dev up --build
  web:
    image: node:20-alpine
    working_dir: /app
    command: >
      sh -c "npm i &&
      VITE_ISSUANCE_URL=http://issuance:3000
      VITE_VERIFICATION_URL=http://verification:3001
      npm run dev -- --host 0.0.0.0"
    volumes:
      - ./web:/app
    ports: ["5173:5173"]
    depends_on: [issuance, verification]
    profiles: ["dev"]

  # PROD frontend (Nginx) – run with: docker compose --profile prod up --build
  web-prod:
    build: ./web
    image: kube-cred-web:1.0.0
    ports: ["${WEB_PORT:-8090}:80"]   # change with WEB_PORT=8090 …
    depends_on: [issuance, verification]
    profiles: ["prod"]
